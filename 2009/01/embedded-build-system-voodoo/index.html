<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.22.0 by Michael Rose
  Copyright 2013-2020 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Embedded Build System Voodoo - Quassel IRC</title>
<meta name="description" content="Qt has this nice feature that you can embed arbitrary files into your binary, and access these so called Resources via special paths starting with a colon. For the longest time, Quassel has exclusively relied on resources and embedded all its data files, including icons, into the binary. This had the advantage that we could always be sure to find all required files at a certain location and need to provide fallback mechanisms. It also meant that Quassel binaries didn’t need to be installed; they were completely standalone and could just be run from any location. Quite nice especially on a platform like Windows that does not have standard locations for all sorts of data files. And on Linux, whose various flavors still do not always agree where stuff should go.  Now, where’s the problem with that approach? For once, the binaries get bigger. Maybe not on the file system (having dozens of small files tends to waste a lot of space due to fragmentation and partial blocks), but certainly in RAM. It also increases loading times a bit. Then there was the issue with translations. We would embed all translations into the binary - obviously a waste of space even though each individual language file is surprisingly small. The LINGUAS variable, restricting the languages to be built, helped a bit, but not much. Distros tend to provide language packs, so support for external files would be needed. But the real killer was KDE integration - KIconLoader, for example, wouldn’t look into our binary to find an icon, obviously. So for KDE support, we needed to install the icons separately. Consequently, Quassel gained support for that a while ago, complete with some confusing cmake options. Over time, we got more data files, such as .knotifyrc for KDE’s notifications, and networks.ini containing predefined network definitions. As it turned out, our build system installed them in locations that would be re-found at run-time only by pure luck, if at all. And it would fail completely on Mac and Windows.  I have fixed that in the past couple days, and Quassel now has proper data file handling. Read on for more information, in particular if you are a distro packager!  First of all, the old cmake options -DOXYGEN_ICONS=External and -DQUASSEL_ICONS=External are gone. They were confusing at best, and road to failure in the worst case. In particular, we didn’t install the Oxygen icons at all if the former option was specified; the rationale being that we would then rely on a system-installed icon theme. Nice idea, but one that goes horribly wrong in a world where icon names and paths change all the time. With Quassel releases not synced to KDE, it would be pure luck to find an Oxygen version that matches all the names used in Quassel. Or one that even contains all the icons, since some of them won’t appear in kdebase before KDE 4.3… So we will need to install both our own and the used subset of Oxygen icons in any case, either as a resource, or into the filesystem.  I figured it wouldn’t make sense to provide bunch of options to specify if various types of files (icons, translations, other data files) should be embedded or not. There is only two cases: Either you want a standalone binary, in which case everything should be embedded, or you install properly, in which case you can as well install all the files. So now there is only one option: -DEMBED_DATA={ON, OFF}, with ON being the default for now. If you set it to OFF, all files get installed externally. Note that this is not yet fully supported on Windows and Mac. You can influence the install location for data files with -DDATA_INSTALL_DIR. The default should be fine though; things go into $PREFIX/share/apps/quassel on Linux for non-KDE, and into whatever-KDE-specifies with KDE support enabled. On Windows, everything goes into %APPDATA%/quassel-irc.org/share/apps/quassel. Mac still needs some love; I don’t know enough about that platform myself.  Both the icon loader and the data file finder have been thouroughly reworked to properly work with scattered files. This includes the search order for icons. A system Oxygen theme (often installed in $data/share/icons) will be preferred over our own copy in $prefix/share/apps/quassel/icons. Afterwards, the hicolor theme will be used as a fallback. Translations go into $prefix/share/apps/quassel/translations.  One side remark probably not interesting for anyone: I have found some cmake feature I didn’t know before. PARENT_SCOPE for setting variables in the enclosing scope. This allowed me to greatly simplify some parts of the build system. I also fixed a whole lot of other issues, most but not all of them related to external data files.  I hope this will help in particular distro packagers! Next up: Bumping our version of Oxygen to include the gorgeous artwork Nuno Pinheiro has done for us, and making sure that we only ship the icons we need rather than most of Oxygen.  But now, sleep.">


  <meta name="author" content="Manuel 'Sputnick' Nickschas">
  
  <meta property="article:author" content="Manuel 'Sputnick' Nickschas">
  


<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Quassel IRC">
<meta property="og:title" content="Embedded Build System Voodoo">
<meta property="og:url" content="https://quassel-irc.org/2009/01/embedded-build-system-voodoo/">


  <meta property="og:description" content="Qt has this nice feature that you can embed arbitrary files into your binary, and access these so called Resources via special paths starting with a colon. For the longest time, Quassel has exclusively relied on resources and embedded all its data files, including icons, into the binary. This had the advantage that we could always be sure to find all required files at a certain location and need to provide fallback mechanisms. It also meant that Quassel binaries didn’t need to be installed; they were completely standalone and could just be run from any location. Quite nice especially on a platform like Windows that does not have standard locations for all sorts of data files. And on Linux, whose various flavors still do not always agree where stuff should go.  Now, where’s the problem with that approach? For once, the binaries get bigger. Maybe not on the file system (having dozens of small files tends to waste a lot of space due to fragmentation and partial blocks), but certainly in RAM. It also increases loading times a bit. Then there was the issue with translations. We would embed all translations into the binary - obviously a waste of space even though each individual language file is surprisingly small. The LINGUAS variable, restricting the languages to be built, helped a bit, but not much. Distros tend to provide language packs, so support for external files would be needed. But the real killer was KDE integration - KIconLoader, for example, wouldn’t look into our binary to find an icon, obviously. So for KDE support, we needed to install the icons separately. Consequently, Quassel gained support for that a while ago, complete with some confusing cmake options. Over time, we got more data files, such as .knotifyrc for KDE’s notifications, and networks.ini containing predefined network definitions. As it turned out, our build system installed them in locations that would be re-found at run-time only by pure luck, if at all. And it would fail completely on Mac and Windows.  I have fixed that in the past couple days, and Quassel now has proper data file handling. Read on for more information, in particular if you are a distro packager!  First of all, the old cmake options -DOXYGEN_ICONS=External and -DQUASSEL_ICONS=External are gone. They were confusing at best, and road to failure in the worst case. In particular, we didn’t install the Oxygen icons at all if the former option was specified; the rationale being that we would then rely on a system-installed icon theme. Nice idea, but one that goes horribly wrong in a world where icon names and paths change all the time. With Quassel releases not synced to KDE, it would be pure luck to find an Oxygen version that matches all the names used in Quassel. Or one that even contains all the icons, since some of them won’t appear in kdebase before KDE 4.3… So we will need to install both our own and the used subset of Oxygen icons in any case, either as a resource, or into the filesystem.  I figured it wouldn’t make sense to provide bunch of options to specify if various types of files (icons, translations, other data files) should be embedded or not. There is only two cases: Either you want a standalone binary, in which case everything should be embedded, or you install properly, in which case you can as well install all the files. So now there is only one option: -DEMBED_DATA={ON, OFF}, with ON being the default for now. If you set it to OFF, all files get installed externally. Note that this is not yet fully supported on Windows and Mac. You can influence the install location for data files with -DDATA_INSTALL_DIR. The default should be fine though; things go into $PREFIX/share/apps/quassel on Linux for non-KDE, and into whatever-KDE-specifies with KDE support enabled. On Windows, everything goes into %APPDATA%/quassel-irc.org/share/apps/quassel. Mac still needs some love; I don’t know enough about that platform myself.  Both the icon loader and the data file finder have been thouroughly reworked to properly work with scattered files. This includes the search order for icons. A system Oxygen theme (often installed in $data/share/icons) will be preferred over our own copy in $prefix/share/apps/quassel/icons. Afterwards, the hicolor theme will be used as a fallback. Translations go into $prefix/share/apps/quassel/translations.  One side remark probably not interesting for anyone: I have found some cmake feature I didn’t know before. PARENT_SCOPE for setting variables in the enclosing scope. This allowed me to greatly simplify some parts of the build system. I also fixed a whole lot of other issues, most but not all of them related to external data files.  I hope this will help in particular distro packagers! Next up: Bumping our version of Oxygen to include the gorgeous artwork Nuno Pinheiro has done for us, and making sure that we only ship the icons we need rather than most of Oxygen.  But now, sleep.">







  <meta property="article:published_time" content="2009-01-25T00:00:00+00:00">






<link rel="canonical" href="https://quassel-irc.org/2009/01/embedded-build-system-voodoo/">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "Quassel Project",
      "url": "https://quassel-irc.org/"
    
  }
</script>






<!-- end _includes/seo.html -->



  <link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Quassel IRC Feed">


<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css">

<!--[if IE]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->


    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single wide">
    <nav class="skip-links">
  <h2 class="screen-reader-text">Skip links</h2>
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
          <a class="site-logo" href="/"><img src="/assets/images/masthead-logo.png" alt=""></a>
        
        <a class="site-title" href="/">
          Quassel IRC
          <span class="site-subtitle">Chat comfortably, everywhere.</span>
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/about/">About</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <svg class="icon" width="16" height="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15.99 16">
            <path d="M15.5,13.12L13.19,10.8a1.69,1.69,0,0,0-1.28-.55l-0.06-.06A6.5,6.5,0,0,0,5.77,0,6.5,6.5,0,0,0,2.46,11.59a6.47,6.47,0,0,0,7.74.26l0.05,0.05a1.65,1.65,0,0,0,.5,1.24l2.38,2.38A1.68,1.68,0,0,0,15.5,13.12ZM6.4,2A4.41,4.41,0,1,1,2,6.4,4.43,4.43,0,0,1,6.4,2Z" transform="translate(-.01)"></path>
          </svg>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      



<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">Manuel 'Sputnick' Nickschas</h3>
    
    
      <div class="author__bio" itemprop="description">
        <p>Core Developer</p>

      </div>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name">Germany</span>
        </li>
      

      
        
          
            <li><a href="https://github.com/quassel/quassel" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i><span class="label">GitHub</span></a></li>
          
        
      

      

      
        <li>
          <a href="mailto:sputnick <at> quassel-irc.org">
            <meta itemprop="email" content="sputnick <at> quassel-irc.org" />
            <i class="fas fa-fw fa-envelope-square" aria-hidden="true"></i><span class="label">Email</span>
          </a>
        </li>
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>



  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Embedded Build System Voodoo">
    <meta itemprop="description" content="Qt has this nice feature that you can embed arbitrary files into your binary, and access these so called Resources via special paths starting with a colon. For the longest time, Quassel has exclusively relied on resources and embedded all its data files, including icons, into the binary. This had the advantage that we could always be sure to find all required files at a certain location and need to provide fallback mechanisms. It also meant that Quassel binaries didn’t need to be installed; they were completely standalone and could just be run from any location. Quite nice especially on a platform like Windows that does not have standard locations for all sorts of data files. And on Linux, whose various flavors still do not always agree where stuff should go.Now, where’s the problem with that approach? For once, the binaries get bigger. Maybe not on the file system (having dozens of small files tends to waste a lot of space due to fragmentation and partial blocks), but certainly in RAM. It also increases loading times a bit. Then there was the issue with translations. We would embed all translations into the binary - obviously a waste of space even though each individual language file is surprisingly small. The LINGUAS variable, restricting the languages to be built, helped a bit, but not much. Distros tend to provide language packs, so support for external files would be needed.But the real killer was KDE integration - KIconLoader, for example, wouldn’t look into our binary to find an icon, obviously. So for KDE support, we needed to install the icons separately. Consequently, Quassel gained support for that a while ago, complete with some confusing cmake options. Over time, we got more data files, such as .knotifyrc for KDE’s notifications, and networks.ini containing predefined network definitions. As it turned out, our build system installed them in locations that would be re-found at run-time only by pure luck, if at all. And it would fail completely on Mac and Windows.I have fixed that in the past couple days, and Quassel now has proper data file handling. Read on for more information, in particular if you are a distro packager!First of all, the old cmake options -DOXYGEN_ICONS=External and -DQUASSEL_ICONS=External are gone. They were confusing at best, and road to failure in the worst case. In particular, we didn’t install the Oxygen icons at all if the former option was specified; the rationale being that we would then rely on a system-installed icon theme. Nice idea, but one that goes horribly wrong in a world where icon names and paths change all the time. With Quassel releases not synced to KDE, it would be pure luck to find an Oxygen version that matches all the names used in Quassel. Or one that even contains all the icons, since some of them won’t appear in kdebase before KDE 4.3… So we will need to install both our own and the used subset of Oxygen icons in any case, either as a resource, or into the filesystem.I figured it wouldn’t make sense to provide bunch of options to specify if various types of files (icons, translations, other data files) should be embedded or not. There is only two cases: Either you want a standalone binary, in which case everything should be embedded, or you install properly, in which case you can as well install all the files. So now there is only one option: -DEMBED_DATA={ON, OFF}, with ON being the default for now. If you set it to OFF, all files get installed externally. Note that this is not yet fully supported on Windows and Mac. You can influence the install location for data files with -DDATA_INSTALL_DIR. The default should be fine though; things go into $PREFIX/share/apps/quassel on Linux for non-KDE, and into whatever-KDE-specifies with KDE support enabled. On Windows, everything goes into %APPDATA%/quassel-irc.org/share/apps/quassel. Mac still needs some love; I don’t know enough about that platform myself.Both the icon loader and the data file finder have been thouroughly reworked to properly work with scattered files. This includes the search order for icons. A system Oxygen theme (often installed in $data/share/icons) will be preferred over our own copy in $prefix/share/apps/quassel/icons. Afterwards, the hicolor theme will be used as a fallback. Translations go into $prefix/share/apps/quassel/translations.One side remark probably not interesting for anyone: I have found some cmake feature I didn’t know before. PARENT_SCOPE for setting variables in the enclosing scope. This allowed me to greatly simplify some parts of the build system. I also fixed a whole lot of other issues, most but not all of them related to external data files.I hope this will help in particular distro packagers! Next up: Bumping our version of Oxygen to include the gorgeous artwork Nuno Pinheiro has done for us, and making sure that we only ship the icons we need rather than most of Oxygen.But now, sleep.">
    <meta itemprop="datePublished" content="2009-01-25T00:00:00+00:00">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">Embedded Build System Voodoo
</h1>
          


        </header>
      

      <section class="page__content" itemprop="text">
        
        <p>Qt has this nice feature that you can embed arbitrary files into your binary, and access these so called <em>Resources</em> via special paths starting with a colon. For the longest time, Quassel has exclusively relied on resources and embedded all its data files, including icons, into the binary. This had the advantage that we could always be sure to find all required files at a certain location and need to provide fallback mechanisms. It also meant that Quassel binaries didn’t need to be installed; they were completely standalone and could just be run from any location. Quite nice especially on a platform like Windows that does not have standard locations for all sorts of data files. And on Linux, whose various flavors still do not always agree where stuff should go.</p>

<p>Now, where’s the problem with that approach? For once, the binaries get bigger. Maybe not on the file system (having dozens of small files tends to waste a lot of space due to fragmentation and partial blocks), but certainly in RAM. It also increases loading times a bit. Then there was the issue with translations. We would embed all translations into the binary - obviously a waste of space even though each individual language file is surprisingly small. The LINGUAS variable, restricting the languages to be built, helped a bit, but not much. Distros tend to provide language packs, so support for external files would be needed.
But the real killer was KDE integration - KIconLoader, for example, wouldn’t look into our binary to find an icon, obviously. So for KDE support, we needed to install the icons separately. Consequently, Quassel gained support for that a while ago, complete with some confusing cmake options. Over time, we got more data files, such as .knotifyrc for KDE’s notifications, and networks.ini containing predefined network definitions. As it turned out, our build system installed them in locations that would be re-found at run-time only by pure luck, if at all. And it would fail completely on Mac and Windows.</p>

<p>I have fixed that in the past couple days, and Quassel now has proper data file handling. Read on for more information, in particular if you are a distro packager!
<!--break-->
First of all, the old cmake options -DOXYGEN_ICONS=External and -DQUASSEL_ICONS=External are gone. They were confusing at best, and road to failure in the worst case. In particular, we didn’t install the <a href="http://www.oxygen-icons.org/">Oxygen icons</a> at all if the former option was specified; the rationale being that we would then rely on a system-installed icon theme. Nice idea, but one that goes horribly wrong in a world where icon names and paths change all the time. With Quassel releases not synced to KDE, it would be pure luck to find an Oxygen version that matches all the names used in Quassel. Or one that even contains all the icons, since some of them won’t appear in kdebase before KDE 4.3… So we will need to install both our own and the used subset of Oxygen icons in any case, either as a resource, or into the filesystem.</p>

<p>I figured it wouldn’t make sense to provide bunch of options to specify if various types of files (icons, translations, other data files) should be embedded or not. There is only two cases: Either you want a standalone binary, in which case everything should be embedded, or you install properly, in which case you can as well install all the files. So now there is only one option: -DEMBED_DATA={ON, OFF}, with ON being the default for now. If you set it to OFF, all files get installed externally. Note that this is not yet fully supported on Windows and Mac. You can influence the install location for data files with -DDATA_INSTALL_DIR. The default should be fine though; things go into $PREFIX/share/apps/quassel on Linux for non-KDE, and into whatever-KDE-specifies with KDE support enabled. On Windows, everything goes into %APPDATA%/quassel-irc.org/share/apps/quassel. Mac still needs some love; I don’t know enough about that platform myself.</p>

<p>Both the icon loader and the data file finder have been thouroughly reworked to properly work with scattered files. This includes the search order for icons. A system Oxygen theme (often installed in $data/share/icons) will be preferred over our own copy in $prefix/share/apps/quassel/icons. Afterwards, the hicolor theme will be used as a fallback. Translations go into $prefix/share/apps/quassel/translations.</p>

<p>One side remark probably not interesting for anyone: I have found some cmake feature I didn’t know before. PARENT_SCOPE for setting variables in the enclosing scope. This allowed me to greatly simplify some parts of the build system. I also fixed a whole lot of other issues, most but not all of them related to external data files.</p>

<p>I hope this will help in particular distro packagers! Next up: Bumping our version of Oxygen to include <a href="http://pinheiro-kde.blogspot.com/2009/01/quassel-couse-we-all-love-irc.html">the gorgeous artwork Nuno Pinheiro has done for us</a>, and making sure that we only ship the icons we need rather than most of Oxygen.</p>

<p>But now, sleep.</p>

        
      </section>

      <footer class="page__meta">
        
        


        
  <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2009-01-25T00:00:00+00:00">January 25, 2009</time></p>


      </footer>

      

      
  <nav class="pagination">
    
      <a href="/2009/01/im-going-to-fosdem/" class="pagination--pager" title="I’m going to FOSDEM!
">Previous</a>
    
    
      <a href="/2009/01/home-sweet-home/" class="pagination--pager" title="$HOME, sweet $HOME
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
</div>

    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><form class="search-content__form" onkeydown="return event.key != 'Enter';">
    <label class="sr-only" for="search">
      Enter your search term...
    </label>
    <input type="search" id="search" class="search-input" tabindex="-1" placeholder="Enter your search term..." />
  </form>
  <div id="results" class="results"></div></div>

      </div>
    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    

    
      
        
      
        
      
        
          <li><a href="https://github.com/quassel/quassel" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
        
      
        
      
        
      
        
      
    

    
      <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
    
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2021 Quassel Project. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>




<script src="/assets/js/lunr/lunr.min.js"></script>
<script src="/assets/js/lunr/lunr-store.js"></script>
<script src="/assets/js/lunr/lunr-en.js"></script>







  </body>
</html>
